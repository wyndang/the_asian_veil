<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Mini Test - Group 2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">

    <style>
        :root {
            /* --- COLOR PALETTE --- */
            --bg-base: #050505;
            --primary-orange: #e65100;
            --primary-light: #ff9800;
            --accent-gold: #f8d300;
            --accent-teal: #ff7700;
            --accent-red: #d32f2f;
            --text-white: #eceff1;
            --text-gray: #b0bec5;
            --glass-bg: rgba(20, 15, 10, 0.85);
            --glass-border: 1px solid rgba(255, 215, 0, 0.15);
            --radius-md: 15px;
            --radius-lg: 25px;
            --font-heading: 'Playfair Display', serif;
            --font-body: 'Lora', serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-base);
            background-image:
                linear-gradient(to bottom, rgba(10, 5, 0, 0.85), rgba(0, 0, 0, 0.95)),
                url('https://images.unsplash.com/photo-1505664194779-8beaceb93744?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text-white);
            font-family: var(--font-body);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* Header */
        header {
            text-align: center;
            padding: 20px;
            font-family: var(--font-heading);
            font-size: 1.6rem;
            font-weight: 700;
            letter-spacing: 2px;
            color: var(--accent-gold);
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            background: rgba(5, 5, 5, 0.95);
            backdrop-filter: blur(10px);
            text-transform: uppercase;
        }

        /* Container */
        .main-container {
            margin-top: 80px;
            flex: 1;
            padding: 40px 15%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        @media (max-width: 1400px) {
            .main-container {
                padding: 40px 8%;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 20px 4%;
                margin-top: 70px;
            }
        }

        /* Screens Animation */
        .screen {
            display: none;
            width: 100%;
            animation: fadeIn 0.6s cubic-bezier(0.25, 1, 0.5, 1);
        }

        .screen.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- Welcome Screen --- */
        #welcome-screen {
            flex-direction: row;
            background: var(--glass-bg);
            border: var(--glass-border);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
            min-height: 70vh;
        }

        .welcome-img {
            flex: 1;
            background-color: #000;
            overflow: hidden;
        }

        .welcome-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.85;
            transition: transform 5s ease;
        }

        #welcome-screen:hover .welcome-img img {
            transform: scale(1.1);
        }

        .welcome-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 50px;
            text-align: center;
        }

        h1 {
            font-family: var(--font-heading);
            font-size: 3.5rem;
            margin-bottom: 15px;
            color: var(--accent-gold);
            font-weight: 700;
            line-height: 1.1;
            text-shadow: 0 4px 15px rgba(255, 215, 0, 0.2);
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--text-gray);
            margin-bottom: 40px;
            font-style: italic;
        }

        /* Buttons Styling */
        .btn {
            padding: 14px 35px;
            font-family: var(--font-heading);
            font-size: 1.1rem;
            font-weight: 700;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-orange), var(--primary-light));
            color: white;
            box-shadow: 0 4px 15px rgba(230, 81, 0, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(230, 81, 0, 0.6);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-white);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-danger {
            background: rgba(211, 47, 47, 0.2);
            color: #ef9a9a;
            border: 1px solid rgba(211, 47, 47, 0.5);
        }

        .btn-danger:hover {
            background: rgba(211, 47, 47, 0.4);
            color: white;
        }

        /* N√∫t qu√† t·∫∑ng m·ªõi */
        .btn-gift-next {
            background: linear-gradient(135deg, #00c853, #64dd17);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 200, 83, 0.4);
            animation: pulse 2s infinite;
            display: none;
            /* M·∫∑c ƒë·ªãnh ·∫©n */
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(0, 200, 83, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(0, 200, 83, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(0, 200, 83, 0);
            }
        }

        /* N√∫t n·ªïi b·∫≠t quay l·∫°i */
        .btn-highlight {
            background: linear-gradient(45deg, #ffd700, #ff8c00);
            color: #000;
            font-weight: 800;
            border: 2px solid #ffffff;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            padding: 15px 40px;
            font-size: 1.2rem;
            animation: pulse-gold 2s infinite;
            margin-top: 20px;
        }

        .btn-highlight:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            background: linear-gradient(45deg, #ffea00, #ff9800);
        }

        @keyframes pulse-gold {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7);
            }

            70% {
                box-shadow: 0 0 0 15px rgba(255, 215, 0, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(255, 215, 0, 0);
            }
        }

        /* --- Quiz Screen --- */
        #quiz-screen {
            flex-direction: row;
            gap: 25px;
            align-items: stretch;
            min-height: 70vh;
        }

        .quiz-left {
            flex: 7;
            background: var(--glass-bg);
            border: var(--glass-border);
            padding: 40px;
            display: flex;
            flex-direction: column;
            border-radius: var(--radius-md);
        }

        .quiz-right {
            flex: 3;
            background: var(--glass-bg);
            border: var(--glass-border);
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            border-radius: var(--radius-md);
        }

        .question-header {
            font-family: var(--font-heading);
            color: var(--accent-teal);
            font-size: 1.3rem;
            margin-bottom: 20px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .question-box {
            font-family: var(--font-heading);
            font-size: 1.5rem;
            line-height: 1.5;
            margin-bottom: 30px;
            color: var(--text-white);
            flex-grow: 1;
        }

        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option-btn {
            padding: 18px 25px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.05rem;
            font-family: var(--font-body);
            border-radius: 12px;
            position: relative;
        }

        .option-btn:hover:not(:disabled) {
            background: rgba(255, 215, 0, 0.1);
            border-color: var(--accent-gold);
            transform: translateX(5px);
        }

        .option-btn.correct {
            background: rgba(0, 200, 83, 0.2) !important;
            border: 1px solid #00e676 !important;
            color: #b9f6ca;
        }

        .option-btn.wrong {
            background: rgba(211, 47, 47, 0.2) !important;
            border: 1px solid #ff5252 !important;
            color: #ffcdd2;
            opacity: 0.7;
        }

        /* Map */
        .map-wrapper {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .map-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            width: 100%;
            margin-top: 15px;
        }

        .map-node {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.4);
            font-family: var(--font-heading);
            font-size: 1.1rem;
            border-radius: 8px;
            transition: 0.3s;
        }

        .map-node.active {
            border-color: var(--accent-teal);
            color: var(--accent-teal);
            background: rgba(0, 191, 165, 0.1);
            box-shadow: 0 0 10px rgba(0, 191, 165, 0.2);
        }

        .map-node.correct {
            background: #2e7d32;
            border-color: #2e7d32;
            color: white;
        }

        .map-node.wrong {
            background: #c62828;
            border-color: #c62828;
            color: white;
        }

        /* Controls */
        .game-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .game-controls .btn {
            width: 100%;
            font-size: 0.95rem;
        }

        /* Gift & Summary & Modal CSS */
        #gift-screen {
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        #gift-screen h2 {
            font-family: var(--font-heading);
            font-size: 3rem;
            color: var(--accent-gold);
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .gift-result {
            font-family: var(--font-heading);
            font-size: 2.2rem;
            color: var(--accent-teal);
            height: 60px;
            margin: 20px 0;
            font-weight: 700;
        }

        .blindbox-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .blindbox {
            width: 90px;
            height: 110px;
            background: linear-gradient(135deg, #ffa000, #ff6f00);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.5);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }

        .blindbox .box-num {
            font-family: var(--font-heading);
            font-size: 1.8rem;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.9);
            z-index: 2;
        }

        .blindbox::before {
            content: "üéÅ";
            position: absolute;
            font-size: 1rem;
            top: 5px;
            right: 5px;
            opacity: 0.5;
        }

        .blindbox:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 30px rgba(255, 160, 0, 0.4);
            border-color: white;
        }

        .blindbox.opened {
            background: #263238;
            border-color: #37474f;
            box-shadow: none;
            cursor: default;
            transform: none;
        }

        .blindbox.opened .box-num {
            color: #546e7a;
        }

        .blindbox.disabled {
            opacity: 0.5;
            pointer-events: none;
            filter: grayscale(100%);
        }

        #summary-screen {
            flex-direction: column;
            background: var(--glass-bg);
            border: var(--glass-border);
            padding: 50px 80px;
            border-radius: var(--radius-lg);
            max-width: 700px;
        }

        .score-big {
            font-family: var(--font-heading);
            font-size: 5rem;
            color: var(--accent-gold);
            margin: 10px 0;
            text-shadow: 0 0 25px rgba(255, 215, 0, 0.5);
        }

        .stat-box {
            font-size: 1.3rem;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
            display: flex;
            justify-content: space-between;
        }

        .stat-label {
            color: var(--text-gray);
        }

        .stat-value {
            font-weight: 700;
            color: var(--accent-teal);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(8px);
        }

        .modal-box {
            background: #1a120b;
            padding: 50px;
            border: 2px solid var(--accent-gold);
            border-radius: var(--radius-lg);
            text-align: center;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 0 60px rgba(255, 215, 0, 0.15);
            animation: popIn 0.3s;
        }

        @keyframes popIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-title {
            font-family: var(--font-heading);
            font-size: 2rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .modal-msg {
            color: var(--text-gray);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        @media (max-width: 768px) {
            #welcome-screen {
                flex-direction: column;
                height: auto;
                padding-bottom: 30px;
            }

            .welcome-img {
                height: 250px;
                width: 100%;
            }

            #quiz-screen {
                flex-direction: column;
            }

            .quiz-left,
            .quiz-right {
                width: 100%;
                flex: auto;
            }

            .blindbox-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .map-grid {
                grid-template-columns: repeat(5, 1fr);
            }

            h1 {
                font-size: 2.5rem;
            }

            .game-controls {
                flex-direction: row;
                flex-wrap: wrap;
            }
        }
    </style>
</head>

<body>

    <header>Mini Test - Group 2</header>

    <div class="main-container">

        <div id="welcome-screen" class="screen active">
            <div class="welcome-img">
                <img src="https://images.unsplash.com/photo-1447069387593-a5de0862481e?q=80&w=2069&auto=format&fit=crop"
                    alt="History Background">
            </div>
            <div class="welcome-content">
                <h1>THE ASIAN VEIL</h1>
                <p class="subtitle">10 c√¢u h·ªèi v·ªÅ nh·ªØng v·∫•n ƒë·ªÅ n·ªïi b·∫≠t c·ªßa c√°c khu v·ª±c ch√¢u √Å tr∆∞·ªõc th·∫ø k·ª∑ XXI v√† hi·ªán
                    nay</p>
                <button class="btn btn-primary" onclick="startTest()">B·∫Øt ƒë·∫ßu ngay</button>
            </div>
        </div>

        <div id="quiz-screen" class="screen">
            <div class="quiz-left">
                <div class="question-header">C√ÇU H·ªéI <span id="current-q-num"
                        style="color: white; font-size: 1.5em;">1</span> / 10</div>
                <div class="question-box" id="question-text">Loading...</div>
                <div class="options-grid" id="options-container">
                </div>
            </div>
            <div class="quiz-right">
                <div class="map-wrapper">
                    <h3 style="font-family: var(--font-heading); color: var(--accent-gold);">B·∫£n ƒë·ªì c√¢u h·ªèi</h3>
                    <div class="map-grid" id="map-container">
                    </div>
                </div>

                <div class="game-controls">
                    <button id="btn-next-step" class="btn btn-gift-next" onclick="goToGift()">üéÅ Nh·∫≠n qu√† & Ti·∫øp
                        t·ª•c</button>

                    <button class="btn btn-primary" onclick="restartTest()">‚ü≥ Ch∆°i l·∫°i</button>
                    <button class="btn btn-danger" onclick="stopTest()">‚úï D·ª´ng l·∫°i</button>
                </div>
            </div>
        </div>

        <div id="gift-screen" class="screen">
            <h2>CH·ªåN QU√Ä</h2>
            <p style="color: var(--text-gray);">Ch·ªçn 1 con s·ªë may m·∫Øn (1-10)</p>
            <div class="gift-result" id="gift-notification"></div>
            <div class="blindbox-grid" id="blindbox-container">
            </div>

            <button class="btn btn-highlight" onclick="backToQuizFromGift()">‚û§ Quay l·∫°i b√†i thi</button>
        </div>

        <div id="summary-screen" class="screen">
            <h2 style="font-family: var(--font-heading); color: white; margin-bottom: 20px;">T·ªîNG K·∫æT</h2>
            <div class="score-big" id="final-score">0/10</div>

            <div class="stat-box">
                <span class="stat-label">T·ªïng th·ªùi gian:</span>
                <span class="stat-value" id="total-time">00:00</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">Trung b√¨nh/c√¢u:</span>
                <span class="stat-value" id="avg-time">00s</span>
            </div>

            <div style="margin-top: 40px; width: 100%;">
                <button class="btn btn-primary" style="width: 100%;" onclick="startTest()">Ch∆°i l·∫°i t·ª´ ƒë·∫ßu</button>
            </div>
        </div>

    </div>

    <div id="modal" class="modal-overlay">
        <div class="modal-box" id="modal-content">
            <div class="modal-title" id="modal-title"></div>
            <div class="modal-msg" id="modal-msg"></div>
            <div id="modal-actions" style="display: flex; gap: 10px; justify-content: center;"></div>
            <button id="modal-btn" class="btn" style="display:none"></button>
        </div>
    </div>

    <script>
        // --- D·ªÆ LI·ªÜU C√ÇU H·ªéI ---
        const questions = [
            { q: "Vi·ªác Anh r√∫t kh·ªèi ti·ªÉu l·ª•c ƒë·ªãa ·∫§n ƒê·ªô v√†o nƒÉm 1947 ƒë√£ d·∫´n ƒë·∫øn h·ªá qu·∫£ tr·ª±c ti·∫øp n√†o sau ƒë√¢y?", options: ["S·ª± th√†nh l·∫≠p Li√™n bang ƒê√¥ng D∆∞∆°ng.", "S·ª± ra ƒë·ªùi c·ªßa hai qu·ªëc gia ·∫§n ƒê·ªô v√† Pakistan d·ª±a tr√™n y·∫øu t·ªë t√¥n gi√°o.", "S·ª± ch·∫•m d·ª©t ho√†n to√†n c√°c tranh ch·∫•p s·∫Øc t·ªôc t·∫°i khu v·ª±c.", "M·ªπ b·∫Øt ƒë·∫ßu thi·∫øt l·∫≠p s·ª± th·ªëng tr·ªã t·∫°i khu v·ª±c Nam √Å."], correct: 1 },
            { q: "ƒê√¢u l√† cu·ªôc xung ƒë·ªôt dai d·∫≥ng nh·∫•t t·∫°i Nam √Å, ƒë∆∞·ª£c coi l√† m·ªëi ƒëe d·ªça nghi√™m tr·ªçng ƒë·ªëi v·ªõi h√≤a b√¨nh th·∫ø gi·ªõi do c·∫£ hai b√™n ƒë·ªÅu s·ªü h·ªØu v≈© kh√≠ h·∫°t nh√¢n?", options: ["N·ªôi chi·∫øn t·∫°i Sri Lanka.", "Xung ƒë·ªôt t·∫°i Afghanistan.", "Tranh ch·∫•p Kashmir gi·ªØa ·∫§n ƒê·ªô v√† Pakistan.", "Tranh ch·∫•p bi√™n gi·ªõi gi·ªØa ·∫§n ƒê·ªô v√† Trung Qu·ªëc."], correct: 2 },
            { q: "Theo c√°c ngu·ªìn t√†i li·ªáu, m·ªôt trong nh·ªØng h·ªá qu·∫£ s√¢u s·∫Øc c·ªßa ch·∫ø ƒë·ªô th·ª±c d√¢n ƒë·ªëi v·ªõi n·ªÅn kinh t·∫ø ƒê√¥ng Nam √Å l√† g√¨?", options: ["Th√∫c ƒë·∫©y ph√°t tri·ªÉn m·∫°nh m·∫Ω ng√†nh c√¥ng nghi·ªáp n·∫∑ng.", "N·ªÅn kinh t·∫ø b·ªã t·ªï ch·ª©c theo ki·ªÉu ‚Äúƒë∆°n canh thu·ªôc ƒë·ªãa‚Äù, t·∫≠p trung khai th√°c nguy√™n li·ªáu.", "Gi·∫£m thi·ªÉu s·ª± l·ªá thu·ªôc v√†o t∆∞ b·∫£n v√† c√¥ng ngh·ªá n∆∞·ªõc ngo√†i.", "X√≥a b·ªè ho√†n to√†n kho·∫£ng c√°ch gi√†u ngh√®o trong x√£ h·ªôi."], correct: 1 },
            { q: "M·ª•c ti√™u ban ƒë·∫ßu c·ªßa Hi·ªáp h·ªôi c√°c qu·ªëc gia ƒê√¥ng Nam √Å (ASEAN) khi th√†nh l·∫≠p nƒÉm 1967 l√† g√¨?", options: ["H√¨nh th√†nh m·ªôt th·ªã tr∆∞·ªùng chung v√† li√™n minh thu·∫ø quan.", "·ªîn ƒë·ªãnh ch√≠nh tr·ªã v√† an ninh khu v·ª±c tr∆∞·ªõc b·ªëi c·∫£nh Chi·∫øn tranh l·∫°nh.", "H·ª£p t√°c ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ bi·∫øn ƒë·ªïi kh√≠ h·∫≠u to√†n c·∫ßu.", "X√¢y d·ª±ng m·ªôt l·ª±c l∆∞·ª£ng qu√¢n ƒë·ªôi chung cho to√†n khu v·ª±c."], correct: 1 },
            { q: "V·∫•n ƒë·ªÅ n√†o sau ƒë√¢y ƒë∆∞·ª£c xem l√† th√°ch th·ª©c an ninh nghi√™m tr·ªçng nh·∫•t hi·ªán nay ƒë·ªëi v·ªõi khu v·ª±c ƒê√¥ng Nam √Å?", options: ["S·ª± thi·∫øu h·ª•t t√†i nguy√™n kho√°ng s·∫£n.", "Tranh ch·∫•p t·∫°i Bi·ªÉn ƒê√¥ng.", "S·ª± s·ª•p ƒë·ªï c·ªßa c√°c ng√†nh c√¥ng nghi·ªáp l·∫Øp r√°p.", "T√¨nh tr·∫°ng m√π ch·ªØ ·ªü c√°c qu·ªëc gia h·∫£i ƒë·∫£o."], correct: 1 },
            { q: "Do t√°c ƒë·ªông c·ªßa bi·∫øn ƒë·ªïi kh√≠ h·∫≠u v√† s·ª•t l√∫n, qu·ªëc gia n√†o ·ªü ƒê√¥ng Nam √Å ƒë√£ ph·∫£i ƒë∆∞a ra quy·∫øt ƒë·ªãnh d·ªùi ƒë√¥?", options: ["Vi·ªát Nam.", "Th√°i Lan.", "Philippines.", "Indonesia."], correct: 3 },
            { q: "ƒê·∫∑c ƒëi·ªÉm n·ªïi b·∫≠t c·ªßa t√¨nh h√¨nh b√°n ƒë·∫£o Tri·ªÅu Ti√™n (ƒê√¥ng B·∫Øc √Å) sau nƒÉm 1945 l√† g√¨?", options: ["S·ª± th·ªëng nh·∫•t nhanh ch√≥ng d∆∞·ªõi s·ª± b·∫£o tr·ª£ c·ªßa Li√™n H·ª£p Qu·ªëc.", "Tr·ªü th√†nh khu v·ª±c trung l·∫≠p, kh√¥ng c√≥ s·ª± hi·ªán di·ªán c·ªßa qu√¢n ƒë·ªôi n∆∞·ªõc ngo√†i.", "S·ª± chia c·∫Øt vƒ©nh vi·ªÖn v√† ƒë·ªëi ƒë·∫ßu qu√¢n s·ª± gi·ªØa CHDCND Tri·ªÅu Ti√™n v√† H√†n Qu·ªëc.", "H√¨nh th√†nh m·ªôt li√™n minh kinh t·∫ø chung gi·ªØa hai mi·ªÅn."], correct: 2 },
            { q: "Nh√¢n t·ªë n√†o ƒë∆∞·ª£c ƒë√°nh gi√° l√† chi ph·ªëi m·∫°nh nh·∫•t c·ª•c di·ªán ch√≠nh tr·ªã ‚Äì an ninh ƒê√¥ng B·∫Øc √Å trong th·∫ø k·ª∑ XXI?", options: ["Tranh ch·∫•p ƒë·∫£o Kuril gi·ªØa Nga v√† Nh·∫≠t B·∫£n.", "C·∫°nh tranh chi·∫øn l∆∞·ª£c gi·ªØa Trung Qu·ªëc v√† M·ªπ.", "S·ª± suy gi·∫£m quy·ªÅn l·ª±c c·ªßa c√°c qu·ªëc gia s·ªü h·ªØu c√¥ng ngh·ªá AI.", "Qu√° tr√¨nh phi qu√¢n s·ª± h√≥a t·∫°i Nh·∫≠t B·∫£n v√† H√†n Qu·ªëc."], correct: 1 },
            { q: "Th√°ch th·ª©c x√£ h·ªôi nghi√™m tr·ªçng m√† khu v·ª±c ƒê√¥ng B·∫Øc √Å ƒëang ph·∫£i ƒë·ªëi m·∫∑t hi·ªán nay l√† g√¨?", options: ["T·ª∑ l·ªá sinh tƒÉng cao g√¢y b√πng n·ªï d√¢n s·ªë.", "Kh·ªßng ho·∫£ng d√¢n s·ªë v·ªõi t·ª∑ l·ªá sinh c·ª±c th·∫•p v√† gi√† h√≥a nhanh.", "S·ª± bi·∫øn m·∫•t c·ªßa c√°c t·∫ßng l·ªõp tri th·ª©c tr·∫ª.", "T√¨nh tr·∫°ng th·∫•t nghi·ªáp do thi·∫øu h·ª•t v·ªën ƒë·∫ßu t∆∞ n∆∞·ªõc ngo√†i."], correct: 1 },
            { q: "Theo ƒë√°nh gi√° chung, khu v·ª±c Nam √Å trong th·∫ø k·ª∑ XXI ƒëang tr·ªü th√†nh ƒë·ªãa b√†n c·∫°nh tranh chi·∫øn l∆∞·ª£c gi·ªØa c√°c c∆∞·ªùng qu·ªëc n√†o?", options: ["Anh, Ph√°p v√† ƒê·ª©c.", "M·ªπ, Trung Qu·ªëc v√† Nga.", "Nh·∫≠t B·∫£n, H√†n Qu·ªëc v√† √öc.", "Brazil, Nam Phi v√† √ù."], correct: 1 }
        ];

        // --- C·∫§U H√åNH QU√Ä T·∫∂NG ---
        const baseGifts = [
            "1 C·ª•c k·∫πo", "1 C·ª•c k·∫πo", "1 C·ª•c k·∫πo", "1 C·ª•c k·∫πo",
            "1 Chai t√†i l·ªôc",
            "1 C√¢y k·∫πo", "1 C√¢y k·∫πo",
            "1 C·ª•c k·∫πo",
            "1 B·ªãch b√°nh",
            "1 B·ªãch b√°nh"
        ];

        let shuffledGifts = [];

        // --- BI·∫æN TR·∫†NG TH√ÅI ---
        let currentQuestion = 0;
        let score = 0;
        let answersState = [];
        let blindboxState = [];
        let currentWrongAttempts = 0;
        let totalPlayTime = 0;
        let sessionStartTime;
        let canPickGift = false;

        // DOM
        const screens = {
            welcome: document.getElementById('welcome-screen'),
            quiz: document.getElementById('quiz-screen'),
            gift: document.getElementById('gift-screen'),
            summary: document.getElementById('summary-screen')
        };
        const modal = document.getElementById('modal');
        const btnNextStep = document.getElementById('btn-next-step');

        // --- √ÇM THANH (S3 Server - ·ªîn ƒë·ªãnh) ---
        const soundCorrect = new Audio('https://s3-us-west-2.amazonaws.com/s.cdpn.io/3/success.mp3');
        const soundWrong = new Audio('https://s3-us-west-2.amazonaws.com/s.cdpn.io/3/error.mp3');
        const soundGift = new Audio('https://s3-us-west-2.amazonaws.com/s.cdpn.io/123941/success.mp3');

        function playSound(audioObj) {
            audioObj.currentTime = 0;
            audioObj.play().catch(e => console.log("Sound error:", e));
        }

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            let newArr = [...array];
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [newArr[currentIndex], newArr[randomIndex]] = [newArr[randomIndex], newArr[currentIndex]];
            }
            return newArr;
        }

        function showScreen(name) {
            Object.values(screens).forEach(s => s.classList.remove('active'));
            screens[name].classList.add('active');
        }

        // --- GAME LOGIC ---

        function startTest() {
            currentQuestion = 0;
            score = 0;
            totalPlayTime = 0;
            answersState = new Array(questions.length).fill(null);
            blindboxState = new Array(10).fill(false);
            shuffledGifts = shuffle(baseGifts);
            sessionStartTime = Date.now();

            showScreen('quiz');
            renderMap();
            loadQuestion(0);
        }

        function restartTest() {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën ch∆°i l·∫°i t·ª´ ƒë·∫ßu kh√¥ng?")) {
                startTest();
            }
        }

        function stopTest() {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën d·ª´ng b√†i thi v√† quay v·ªÅ m√†n h√¨nh ch√≠nh?")) {
                showScreen('welcome');
            }
        }

        function loadQuestion(index) {
            currentQuestion = index;
            currentWrongAttempts = 0;
            btnNextStep.style.display = 'none';

            document.getElementById('current-q-num').innerText = index + 1;
            const qData = questions[index];
            document.getElementById('question-text').innerText = qData.q;
            const optionsDiv = document.getElementById('options-container');
            optionsDiv.innerHTML = '';

            const isAnswered = answersState[index] !== null;

            qData.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = ["A. ", "B. ", "C. ", "D. "][idx] + opt;

                if (isAnswered) {
                    btn.disabled = true;
                    if (idx === qData.correct) btn.classList.add('correct');
                    else btn.classList.add('disabled');

                    if (answersState[index] === true) {
                        btnNextStep.style.display = 'block';
                    }
                } else {
                    btn.onclick = () => checkAnswer(idx, btn);
                }
                optionsDiv.appendChild(btn);
            });
            updateMap();
        }

        function checkAnswer(selectedIndex, btnElement) {
            const correctIndex = questions[currentQuestion].correct;

            if (selectedIndex === correctIndex) {
                // ƒê√öNG
                playSound(soundCorrect);

                let pointsAdded = 0;
                if (currentWrongAttempts === 0) pointsAdded = 1;
                else if (currentWrongAttempts === 1) pointsAdded = 0.5;
                else pointsAdded = 0;

                score += pointsAdded;
                answersState[currentQuestion] = true;
                btnElement.classList.add('correct');

                const options = document.querySelectorAll('.option-btn');
                options.forEach(b => b.disabled = true);

                btnNextStep.style.display = 'block';
                showSuccessModal(pointsAdded);

            } else {
                // SAI
                playSound(soundWrong);
                currentWrongAttempts++;
                btnElement.classList.add('wrong');
                btnElement.disabled = true;
            }
            updateMap();
        }

        function renderMap() {
            const mapContainer = document.getElementById('map-container');
            mapContainer.innerHTML = '';
            for (let i = 0; i < questions.length; i++) {
                const node = document.createElement('div');
                node.className = 'map-node';
                node.innerText = i + 1;
                node.id = `map-node-${i}`;
                mapContainer.appendChild(node);
            }
        }

        function updateMap() {
            for (let i = 0; i < questions.length; i++) {
                const node = document.getElementById(`map-node-${i}`);
                node.className = 'map-node';
                if (i === currentQuestion) node.classList.add('active');
                if (answersState[i] === true) node.classList.add('correct');
            }
        }

        // --- MODAL ---
        function showSuccessModal(points) {
            const title = document.getElementById('modal-title');
            const msg = document.getElementById('modal-msg');
            const actionsDiv = document.getElementById('modal-actions');

            actionsDiv.innerHTML = '';
            document.getElementById('modal-btn').style.display = 'none';

            modal.style.display = 'flex';
            title.innerText = "CH√çNH X√ÅC!";
            title.style.color = "#00e676";

            let pointMsg = "";
            if (points === 1) pointMsg = "Xu·∫•t s·∫Øc! Ch√∫c m·ª´ng b·∫°n ƒë·∫°t ƒë∆∞·ª£c 1 ƒëi·ªÉm.";
            else if (points === 0.5) pointMsg = "B·∫°n ƒë·∫°t 0.5 ƒëi·ªÉm cho c√¢u n√†y.";
            else pointMsg = "B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng (0ƒë do sai qu√° 2 l·∫ßn).";

            msg.innerText = pointMsg;

            const btnReview = document.createElement('button');
            btnReview.className = 'btn btn-secondary';
            btnReview.innerText = "Xem l·∫°i c√¢u h·ªèi";
            btnReview.onclick = closeModal;

            const btnGift = document.createElement('button');
            btnGift.className = 'btn btn-primary';
            btnGift.innerText = "ƒêi nh·∫≠n qu√† üéÅ";
            btnGift.onclick = goToGift;

            actionsDiv.appendChild(btnReview);
            actionsDiv.appendChild(btnGift);
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                loadQuestion(currentQuestion + 1);
            } else {
                endGame();
            }
        }

        // --- GIFT LOGIC ---
        function goToGift() {
            closeModal();
            totalPlayTime += (Date.now() - sessionStartTime);

            canPickGift = true;
            showScreen('gift');
            renderBlindboxes();
            document.getElementById('gift-notification').innerText = "";
        }

        function renderBlindboxes() {
            const container = document.getElementById('blindbox-container');
            container.innerHTML = '';

            for (let i = 0; i < 10; i++) {
                const box = document.createElement('div');
                let className = 'blindbox';
                if (blindboxState[i]) className += ' opened';
                if (canPickGift && blindboxState[i]) className += ' disabled';
                if (!canPickGift) className += ' disabled';

                box.className = className;

                const numSpan = document.createElement('span');
                numSpan.className = 'box-num';
                numSpan.innerText = blindboxState[i] ? '' : (i + 1);
                box.appendChild(numSpan);

                if (blindboxState[i]) {
                    const content = document.createElement('div');
                    content.style.fontSize = "0.9rem";
                    content.style.fontWeight = "bold";
                    content.style.color = "#eceff1";
                    content.innerText = shuffledGifts[i];
                    box.appendChild(content);
                }

                if (!blindboxState[i] && canPickGift) {
                    box.onclick = () => openGift(i, box);
                }
                container.appendChild(box);
            }
        }

        function openGift(index, element) {
            if (!canPickGift) return;

            playSound(soundGift);

            blindboxState[index] = true;
            const reward = shuffledGifts[index];
            const noti = document.getElementById('gift-notification');
            noti.innerText = "B·∫°n nh·∫≠n ƒë∆∞·ª£c: " + reward;
            canPickGift = false;
            renderBlindboxes();
        }

        function backToQuizFromGift() {
            sessionStartTime = Date.now();
            showScreen('quiz');
            nextQuestion();
        }

        // --- END GAME ---
        function endGame() {
            if (screens.quiz.classList.contains('active')) {
                totalPlayTime += (Date.now() - sessionStartTime);
            }

            showScreen('summary');
            document.getElementById('final-score').innerText = `${score}/${questions.length}`;

            const seconds = Math.floor(totalPlayTime / 1000);
            const minutes = Math.floor(seconds / 60);
            const remainSeconds = seconds % 60;

            document.getElementById('total-time').innerText =
                `${minutes.toString().padStart(2, '0')}:${remainSeconds.toString().padStart(2, '0')}`;

            const avg = (seconds / questions.length).toFixed(1);
            document.getElementById('avg-time').innerText = avg + "s";
        }

    </script>
</body>

</html>